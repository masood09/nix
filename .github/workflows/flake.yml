---
name: Bump flake.lock

on:
  schedule:
    # 10am UTC is 6am EDT/5am EST
    - cron: 0 10 * * 4

  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  bump:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Install Nix
        uses: cachix/install-nix-action@v31

      - name: Update flake.lock
        run: nix flake update

      - name: Create or update PR
        uses: peter-evans/create-pull-request@v8
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: chore/bump-flake-lock
          base: main
          title: "chore(deps): bump flake.lock"
          commit-message: "chore(deps): bump flake.lock"
          body: |
            Automated weekly update of `flake.lock` via `nix flake update`.
          labels: dependencies
          delete-branch: true
          add-paths: flake.lock
